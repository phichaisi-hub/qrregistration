services:
  # 1. Database: MariaDB
  db:
    image: mariadb:10.6
    container_name: event-db
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: event_db
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - event-net

  # 2. Web Server: Apache + PHP
  web:
    image: php:8.1-apache
    container_name: event-web
    restart: always
    depends_on:
      - db
    ports:
      - "8080:80"
    volumes:
      - .:/var/www/html  # เชื่อมโฟลเดอร์ปัจจุบันเข้ากับโฟลเดอร์เว็บ
    networks:
      - event-net

  # 3. File Manager: Login แล้วจัดการไฟล์ใน /var/www/html ได้เลย
  filemanager:
    image: filebrowser/filebrowser:latest
    container_name: event-filemanager
    restart: always
    user: "0:0"  # รันเป็น Root เพื่อให้มีสิทธิ์เขียน/แก้ไขไฟล์ในเครื่อง
    ports:
      - "8099:80"
    volumes:
      - .:/srv  # เชื่อมโฟลเดอร์เดียวกับ web เข้าที่ /srv (ซึ่งเป็น Root ของตัวนี้)
    # ตั้งค่าให้ไม่ต้องมีขั้นตอน Setup และ Login เข้ามาเห็นไฟล์ได้เลย
    command: [ "--noauth" ] # **(ตัวเลือก)** ถ้าต้องการให้ Login ปกติ ให้เอาบรรทัดนี้ออก
    networks:
      - event-net

  # 4. phpMyAdmin: จัดการฐานข้อมูล
  phpmyadmin:
    image: phpmyadmin:latest
    container_name: event-phpmyadmin
    depends_on:
      - db
    ports:
      - "8081:80"
    environment:
      PMA_HOST: db
    networks:
      - event-net

networks:
  event-net:

volumes:
  db_data:
